{% extends 'base.html' %}

{% block content %}
<!-- Page Header -->
<div class="mb-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-custom">
      <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page">My Requests</li>
    </ol>
  </nav>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-2" style="color: #1a1a1a; font-weight: 700;">
        <i class="bi bi-file-earmark-check me-2" style="color: #0d6efd;"></i>My Aid Requests
      </h1>
      <p class="text-muted">Track and manage your aid request applications</p>
    </div>
    <a href="{% url 'request_create' %}" class="btn btn-primary btn-lg d-none d-md-inline-block">
      <i class="bi bi-plus-circle me-2"></i>New Request
    </a>
  </div>
</div>

<!-- Requests Table -->
<div class="card">
  <div class="card-body p-0">
    {% if requests %}
      <div class="table-responsive">
        <table class="table table-hover mb-0" role="table" aria-describedby="request-list-desc">
          <caption id="request-list-desc" class="visually-hidden">List of aid requests you have submitted</caption>
          <thead>
            <tr>
              <th scope="col"><i class="bi bi-box"></i> Item</th>
              <th scope="col" style="width: 100px;">Quantity</th>
              <th scope="col" style="width: 140px;">Date Submitted</th>
              <th scope="col" style="width: 120px;">Status</th>
              <th scope="col" style="width: 80px;" aria-hidden="true">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for req in requests %}
            <tr>
              <td class="fw-500">{{ req.item_requested }}</td>
              <td>{{ req.quantity_requested }}</td>
              <td>{{ req.date_requested|date:"M d, Y" }}</td>
              <td>
                {% if req.status == 'APPROVED' %}
                  <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Approved</span>
                {% elif req.status == 'PENDING' %}
                  <span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split me-1"></i>Pending</span>
                {% elif req.status == 'REJECTED' %}
                  <span class="badge bg-danger"><i class="bi bi-x-circle me-1"></i>Rejected</span>
                {% else %}
                  <span class="badge bg-secondary">{{ req.get_status_display }}</span>
                {% endif %}
              </td>
              <td>
                <a href="{% url 'request_detail' req.pk %}" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-eye me-1"></i>View
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if is_paginated %}
      <nav aria-label="Page navigation" class="p-3 border-top">
        <ul class="pagination mb-0 justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page=1"><i class="bi bi-chevron-double-left"></i></a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}"><i class="bi bi-chevron-left"></i></a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-double-left"></i></span></li>
            <li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-left"></i></span></li>
          {% endif %}
          
          <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>
          
          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}"><i class="bi bi-chevron-right"></i></a></li>
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}"><i class="bi bi-chevron-double-right"></i></a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-right"></i></span></li>
            <li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-double-right"></i></span></li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    {% else %}
      <!-- Empty State -->
      <div class="empty-state py-5">
        <div class="empty-state-icon">
          <i class="bi bi-inbox"></i>
        </div>
        <h3>No Requests Yet</h3>
        <p class="text-muted mb-4">You haven't submitted any aid requests. Start by creating your first request.</p>
        <a href="{% url 'request_create' %}" class="btn btn-primary">
          <i class="bi bi-plus-circle me-2"></i>Submit Your First Request
        </a>
      </div>
    {% endif %}
  </div>
</div>

<!-- Mobile floating action button -->
<div class="d-md-none mt-4 d-grid">
  <a href="{% url 'request_create' %}" class="btn btn-primary btn-lg">
    <i class="bi bi-plus-circle me-2"></i>New Request
  </a>
</div>
{% endblock %}
